{% extends "base.html" %}

{% block title %}Студенты{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Студенты</h2>
    {% if current_user.is_authenticated %}
        <a href="{{ url_for('create_student') }}" class="btn btn-primary">Добавить студента</a>
    {% endif %}
</div>

<!-- Фильтры и поиск -->
<form method="GET" class="mb-4">
    <div class="row g-3">
        <div class="col-md-6">
            <input type="text" name="q" class="form-control" placeholder="Поиск по ФИО..." value="{{ query }}">
        </div>
        <div class="col-md-4">
            <select name="university_id" class="form-select">
                <option value="">Все университеты</option>
                {% for university in universities %}
                    <option value="{{ university.id }}" {% if selected_university == university.id %}selected{% endif %}>
                        {{ university.short_name }}
                    </option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-2">
            <button type="submit" class="btn btn-outline-secondary w-100">Применить</button>
        </div>
    </div>
    {% if query or selected_university %}
        <div class="mt-2">
            <a href="{{ url_for('students') }}" class="btn btn-outline-danger btn-sm">Сбросить фильтры</a>
        </div>
    {% endif %}
</form>

<!-- Таблица студентов -->
<div class="table-responsive">
    <table class="table table-striped">
        <thead>
            <tr>
                <th>ФИО</th>
                <th>Дата рождения</th>
                <th>Университет</th>
                <th>Год поступления</th>
                {% if current_user.is_authenticated %}
                    <th>Действия</th>
                {% endif %}
            </tr>
        </thead>
        <tbody>
            {% for student in students.items %}
            <tr>
                <td>{{ student.full_name }}</td>
                <td>{{ format_date(student.birth_date) }}</td>
                <td>{{ student.university.short_name }}</td>
                <td>{{ student.enrollment_year }}</td>
                {% if current_user.is_authenticated %}
                <td class="table-actions">
                    <a href="{{ url_for('update_student', id=student.id) }}" class="btn btn-sm btn-warning">Редактировать</a>
                    <form action="{{ url_for('delete_student', id=student.id) }}" method="POST" style="display: inline;">
                        <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Вы уверены?')">Удалить</button>
                    </form>
                </td>
                {% endif %}
            </tr>
            {% else %}
            <tr>
                <td colspan="{% if current_user.is_authenticated %}5{% else %}4{% endif %}" class="text-center">Студенты не найдены</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Пагинация -->
{% if students.pages > 1 %}
<nav>
    <ul class="pagination justify-content-center">
        {% for page_num in students.iter_pages() %}
            {% if page_num %}
                <li class="page-item {% if page_num == students.page %}active{% endif %}">
                    <a class="page-link" href="{{ url_for('students', page=page_num, q=query, university_id=selected_university) }}">{{ page_num }}</a>
                </li>
            {% else %}
                <li class="page-item disabled"><span class="page-link">...</span></li>
            {% endif %}
        {% endfor %}
    </ul>
</nav>
{% endif %}
{% endblock %}