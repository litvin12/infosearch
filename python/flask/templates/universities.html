{% extends "base.html" %}

{% block title %}Университеты{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Университеты</h2>
    {% if current_user.is_authenticated %}
        <a href="{{ url_for('create_university') }}" class="btn btn-primary">Добавить университет</a>
    {% endif %}
</div>

<!-- Поиск -->
<form method="GET" class="mb-4">
    <div class="input-group">
        <input type="text" name="q" class="form-control" placeholder="Поиск по названию..." value="{{ query }}">
        <button type="submit" class="btn btn-outline-secondary">Найти</button>
        {% if query %}
            <a href="{{ url_for('universities') }}" class="btn btn-outline-danger">Сбросить</a>
        {% endif %}
    </div>
</form>

<!-- Таблица университетов -->
<div class="table-responsive">
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Полное название</th>
                <th>Сокращенное название</th>
                <th>Дата основания</th>
                <th>Кол-во студентов</th>
                {% if current_user.is_authenticated %}
                    <th>Действия</th>
                {% endif %}
            </tr>
        </thead>
        <tbody>
            {% for university in universities.items %}
            <tr>
                <td>{{ university.full_name }}</td>
                <td><strong>{{ university.short_name }}</strong></td>
                <td>{{ format_date(university.established_date) }}</td>
                <td>{{ university.students|length }}</td>
                {% if current_user.is_authenticated %}
                <td class="table-actions">
                    <a href="{{ url_for('update_university', id=university.id) }}" class="btn btn-sm btn-warning">Редактировать</a>
                    <form action="{{ url_for('delete_university', id=university.id) }}" method="POST" style="display: inline;">
                        <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Вы уверены?')">Удалить</button>
                    </form>
                </td>
                {% endif %}
            </tr>
            {% else %}
            <tr>
                <td colspan="{% if current_user.is_authenticated %}5{% else %}4{% endif %}" class="text-center">Университеты не найдены</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Пагинация -->
{% if universities.pages > 1 %}
<nav>
    <ul class="pagination justify-content-center">
        {% for page_num in universities.iter_pages() %}
            {% if page_num %}
                <li class="page-item {% if page_num == universities.page %}active{% endif %}">
                    <a class="page-link" href="{{ url_for('universities', page=page_num, q=query) }}">{{ page_num }}</a>
                </li>
            {% else %}
                <li class="page-item disabled"><span class="page-link">...</span></li>
            {% endif %}
        {% endfor %}
    </ul>
</nav>
{% endif %}
{% endblock %}